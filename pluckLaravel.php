<?php 

$ky = [
	"ky" => array(
		"0" => array(
			"ky_no" => "206000000288",
			"user_cd" => "100000002118",
			"ky_syu_kb" => "6",
			"ky_next_kb" => "0",
			"ky_auto_kb" => "0",
			"kess_kb" => "0",
			"enter_ymd" => "2021-08-04 00:00:00.000",
			"leave_ymd" => "",
			"cont_ky_su" => "36",
			"ky_i_ymd" => "2021-09-01 00:00:00.000",
			"ky_tuti_fg" => "1",
			"ushin_cd" => "",
			"ky_hon_kin" => "0",
			"biko" => "",
			"del_fg" => "0",
			"torok_ymdhms" => "2021-08-04 11:47:39.127",
			"up_ymdhms" => "2021-08-04 11:48:00.483",
			"up_tans_cd" => "9999",
			"up_tans_nm" => "",
			"kai_nm" => "ソリマチＷＥＢテストパートナー予備５",
			"user_nm" => "パートナー予備５　テスト",
			"ky_syu_nm" => "ＳＡＡＧ",
			"ky_next_nm" => "有料",
			"ky_auto_nm" => "自動",
			"kess_nm" => "なし",
			"ky_tuti_nm" => "未発送",
			"shin_nm" => "",
			"cti_syu_kb" => "0",
			"ky_his" => array(
				"0" => array(
					"ky_no" => "206000000288",
					"ky_his_ren" => "3",
					"ky_his_syu_kb" => "4",
					"ky_s_ymd" => "2018-10-01 00:00:00.000",
					"ky_e_ymd" => "2019-09-30 00:00:00.000",
					"d_no" => "",
					"dm_no" => "0",
					"ky_su" => "12",
					"ky_shin_no" => "",
					"del_fg" => "0",
					"torok_ymdhms" => "2021-08-04 11:48:00.483",
					"up_ymdhms" => "2021-08-04 11:48:00.483",
					"up_tans_cd" => "9999",
					"up_tans_nm" => "",
					"ky_his_syu_nm" => "更新（有料）",
				),

				"1" => array(
					"ky_no" => "206000000288",
					"ky_his_ren" => "2",
					"ky_his_syu_kb" => "4",
					"ky_s_ymd" => "2017-10-01 00:00:00.000",
					"ky_e_ymd" => "2018-09-30 00:00:00.000",
					"d_no" => "",
					"dm_no" => "0",
					"ky_su" => "12",
					"ky_shin_no" => "",
					"del_fg" => "0",
					"torok_ymdhms" => "2021-08-04 11:47:51.113",
					"up_ymdhms" => "2021-08-04 11:47:51.113",
					"up_tans_cd" => "9999",
					"up_tans_nm" => "",
					"ky_his_syu_nm" => "更新（有料）",
				),

				"2" => array(
					"ky_no" => "206000000288",
					"ky_his_ren" => "1",
					"ky_his_syu_kb" => "1",
					"ky_s_ymd" => "2016-10-01 00:00:00.000",
					"ky_e_ymd" => "2017-09-30 00:00:00.000",
					"d_no" => "",
					"dm_no" => "0",
					"ky_su" => "12",
					"ky_shin_no" => "",
					"del_fg" => "0",
					"torok_ymdhms" => "2021-08-04 11:47:39.127",
					"up_ymdhms" => "2021-08-04 11:47:39.127",
					"up_tans_cd" => "2",
					"up_tans_nm" => "渡邉　健太郎",
					"ky_his_syu_nm" => "新規（有料）",
				)

			)

		),

		"1" => array(
			"ky_no" => "206000000295",
			"user_cd" => "100000002118",
			"ky_syu_kb" => "6",
			"ky_next_kb" => "0",
			"ky_auto_kb" => "0",
			"kess_kb" => "0",
			"enter_ymd" => "2021-08-04 00:00:00.000",
			"leave_ymd" => "2021-08-04 00:00:00.000",
			"cont_ky_su" => "36",
			"ky_i_ymd" => "2021-09-01 00:00:00.000",
			"ky_tuti_fg" => "1",
			"ushin_cd" => "",
			"ky_hon_kin" => "0",
			"biko" => "",
			"del_fg" => "0",
			"torok_ymdhms" => "2021-08-04 11:48:50.117",
			"up_ymdhms" => "2021-08-04 11:49:05.757",
			"up_tans_cd" => "2",
			"up_tans_nm" => "渡邉　健太郎",
			"kai_nm" => "ソリマチＷＥＢテストパートナー予備５",
			"user_nm" => "パートナー予備５　テスト",
			"ky_syu_nm" => "ＳＡＡＧ",
			"ky_next_nm" => "有料",
			"ky_auto_nm" => "自動",
			"kess_nm" => "なし",
			"ky_tuti_nm" => "未発送",
			"shin_nm" => "",
			"cti_syu_kb" => "0",
			"ky_his" => array(
				"0" => array(
					"ky_no" => "206000000295",
					"ky_his_ren" => "3",
					"ky_his_syu_kb" => "7",
					"ky_s_ymd" => "2007-09-01 00:00:00.000",
					"ky_e_ymd" => "2008-08-31 00:00:00.000",
					"d_no" => "",
					"dm_no" => "0",
					"ky_su" => "12",
					"ky_shin_no" => "",
					"del_fg" => "0",
					"torok_ymdhms" => "2021-08-04 11:49:02.553",
					"up_ymdhms" => "2021-08-04 11:49:05.757",
					"up_tans_cd" => "2",
					"up_tans_nm" => "渡邉　健太郎",
					"ky_his_syu_nm" => "解約",
				),

				"1" => array(
					"ky_no" => "206000000295",
					"ky_his_ren" => "2",
					"ky_his_syu_kb" => "1",
					"ky_s_ymd" => "2006-09-01 00:00:00.000",
					"ky_e_ymd" => "2007-08-31 00:00:00.000",
					"d_no" => "",
					"dm_no" => "0",
					"ky_su" => "12",
					"ky_shin_no" => "",
					"del_fg" => "0",
					"torok_ymdhms" => "2021-08-04 11:48:56.900",
					"up_ymdhms" => "2021-08-04 11:48:56.900",
					"up_tans_cd" => "9999",
					"up_tans_nm" => "",
					"ky_his_syu_nm" => "新規（有料）",
				),

				"2" => array(
					"ky_no" => "206000000295",
					"ky_his_ren" => "1",
					"ky_his_syu_kb" => "1",
					"ky_s_ymd" => "2005-09-01 00:00:00.000",
					"ky_e_ymd" => "2006-08-31 00:00:00.000",
					"d_no" => "",
					"dm_no" => "0",
					"ky_su" => "12",
					"ky_shin_no" => "",
					"del_fg" => "0",
					"torok_ymdhms" => "2021-08-04 11:48:50.117",
					"up_ymdhms" => "2021-08-04 11:48:50.117",
					"up_tans_cd" => "2",
					"up_tans_nm" => "渡邉　健太郎",
					"ky_his_syu_nm" => "新規（有料）",
				)
			)
		)
	)
];


	function GetYMD($res, $field, $parr = "", &$count = 0, &$arr = [])
	{
		$tmp = "";
		if (($field == "error" || $field == "err_msg") &&
			$parr == "" && count($res) == 2 && $res["message"] != ""
		) {
			return $res["message"];
		}
		if ($parr == $field) {
			return $res;
		}
		foreach ($res as $key => $val) {
			if (is_array($val)) {
				$parr = ($key == "0") ? $parr : $key;
				$val = GetYMD($val, $field, $parr, $count, $arr);
				if ($val != "") {
					return $val;
				}
			} elseif ($key == "ky_his_syu_kb") {
				$tmp = $val;
			} elseif ($key == $field) {
				// print_r("key: " . $val);
				$arr[$val] = $tmp;
				$count += 1;
			}
		}
		return "";
	}

	function GetListByField($res, &$listData, $field, $parr = "")
	{
		$tmp = "";
		if (($field == "error" || $field == "err_msg") &&
			$parr == "" && count($res) == 2 && $res["message"] != ""
		) {
			$listData[] = $res["message"];
			return;
		}
		if ($parr == $field) {
			foreach ($res as $val) {
				$listData[] = $val;
			}
			return;
		}
		foreach ($res as $key => $val) {
			if (is_array($val)) {
				$parr = ($key == "0") ? $parr : $key;
				GetListByField($val, $listData, $field, $parr);
			} elseif ($key == "ky_his_syu_kb") {
				$tmp = $val;
			} elseif ($key == $field) {
				$listData[$val] = $tmp;
			}
		}
	}

$arr = [];
$num = 0;
GetYMD($ky, "ky_e_ymd", "", $num, $arr);
print_r($arr);


$listData = [];
GetListByField($ky, $listData, "ky_e_ymd", "");

// print_r(max(array_keys($listData)));
print_r($listData);